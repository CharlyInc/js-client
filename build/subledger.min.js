/*! Subledger 1.0.0-beta1 | (c) 2013 Subledger | https://github.com/boocx2/Subledger_JS_Library/blob/master/LICENSE.txt */
!function(a){var b=function(a){this.url=a?c.removeTrailingSlash(a):""};b.prototype.book=function(a){var b=this,e=b.url,f={};return e+="/books",f.get=function(b,f){c.isFunction(b)&&(f=b,b={}),a||(b.state=b.state?b.state:"active",b.starting=b.starting?b.starting:0,e=e+"?"+c.encodeQueryObj(b)),d.get(e,f)},f.create=function(a,b){d.post(e,a,b)},a&&(e=e+"/"+a,f.update=function(a,b){d.patch(e,a,b)},f.activate=function(a){d.post(e+"/activate",a)},f.archive=function(a){d.post(e+"/archive",a)},f.account=function(a){var b={};return e+="/accounts",b.get=function(b,f){c.isFunction(b)&&(f=b,b={}),a||(b.state=b.state?b.state:"active",b.starting=b.starting?b.starting:0,e=e+"?"+c.encodeQueryObj(b)),d.get(e,f)},b.create=function(a,b){d.post(e,a,b)},a&&(e=e+"/"+a,b.update=function(a,b){d.patch(e,a,b)},b.activate=function(a){d.post(e+"/activate",a)},b.archive=function(a){d.post(e+"/archive",a)},b.balance=function(a,b){c.isFunction(a)&&(b=a,a={}),a.at=a.at?a.at:(new Date).toISOString(),d.get(e+"/balance?"+c.encodeQueryObj(a),b)},b.line=function(a){var b={};return e+="/lines",b.get=function(b,f){c.isFunction(b)&&(f=b,b={}),a||(b.before=b.before?b.before:(new Date).toISOString(),e=e+"?"+c.encodeQueryObj(b)),d.get(e,f)},a&&(e=e+"/"+a),b}),b},f.journalEntry=function(a){var b={};return e+="/journal_entries",b.get=function(b,f){c.isFunction(b)&&(f=b,b={},b.before=(new Date).toISOString()),a||(b.state=b.state?b.state:"active",e=e+"?"+c.encodeQueryObj(b)),d.get(e,f)},b.create=function(a,b){d.post(e,a,b)},b.createAndPost=function(a,b){d.post(e+"/create_and_post",a,b)},a&&(e=e+"/"+a,b.post=function(a){d.post(e,a)},b.update=function(a,b){d.patch(e,a,b)},b.activate=function(a){d.post(e+"/activate",a)},b.archive=function(a){d.post(e+"/archive",a)},b.balance=function(a){d.get(e+"/balance",a)},b.progress=function(a){d.get(e+"/progress",a)},b.line=function(a){var b={};return b.get=function(b,f){c.isFunction(b)&&(f=b,b={}),a||(b.before=b.starting?b.starting:(new Date).toISOString(),b.state=b.state?b.state:"active",e=e+"/lines?"+c.encodeQueryObj(b)),d.get(e,f)},b.create=function(a,b){d.post(e+"/create_line",a,b)},a&&(e=e+"/lines/"+a,b.update=function(a,b){d.patch(e,a,b)},b.activate=function(a){d.post(e+"/activate",a)},b.archive=function(a){d.post(e+"/archive",a)}),b}),b}),f};var c={isArray:Array.isArray||function(a){return"[object Array]"===toString.call(a)},isObject:function(a){return"[object Object]"===toString.call(a)},isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},encodeQueryObj:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},removeTrailingSlash:function(a){return a.replace(/\/*$/,"")}},d=function(){function a(){this._callbacks=[]}function b(a){var b="";if("string"==typeof a)b=a;else{var c=encodeURIComponent;for(var d in a)a.hasOwnProperty(d)&&(b+="&"+c(d)+"="+c(a[d]))}return b}function d(){var a;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}return a}function e(c,e,f,g){function i(){j.abort(),l.done(h.ETIMEOUT,"",j)}var j,k,l=new a;f=f||{},g=g||{};try{j=d()}catch(m){return l.done(h.ENOXHR,""),l}k=b(f),"GET"===c&&k&&(e+="?"+k,k=null),j.open(c,e),j.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var n in g)g.hasOwnProperty(n)&&j.setRequestHeader(n,g[n]);var o=h.ajaxTimeout;if(o)var p=setTimeout(i,o);return j.onreadystatechange=function(){if(o&&clearTimeout(p),4===j.readyState){var a=!j.status||(j.status<200||j.status>=300)&&304!==j.status;l.done(a,j.responseText,j)}},j.send(k),l}function f(a){return function(b,c,d){return e(a,b,c,d)}}function g(a,b){var c={};return c.data=JSON.parse(b),c.err=a?new Error(c.data.exception||""):null,c}a.prototype.then=function(b,c){var d;return this._isdone?d=b.apply(c,this.result):(d=new a,this._callbacks.push(function(){var a=b.apply(c,arguments);a&&"function"==typeof a.then&&a.then(d.done,d)})),d},a.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[]};var h={get:f("GET"),post:f("POST"),put:f("PUT"),patch:f("PATCH"),del:f("DELETE"),ENOXHR:1,ETIMEOUT:2,ajaxTimeout:0},i={get:function(a,b){h.get(a).then(function(a,c){return c=g(a,c),b(c.err,c.data)})},post:function(a,b,d){c.isFunction(b)&&(d=b,b={}),h.post(a,b).then(function(a,b){return b=g(a,b),d(b.err,b.data)})},put:function(a,b,d){c.isFunction(b)&&(d=b,b={}),h.put(a,b).then(function(a,b){return b=g(a,b),d(b.err,b.data)})},patch:function(a,b,d){c.isFunction(b)&&(d=b,b={}),h.patch(a,b).then(function(a,b){return b=g(a,b),d(b.err,b.data)})},del:function(a,b){h.del(a).then(function(a,c){return c=g(a,c),b(c.err,c.data)})}};return i}();Date.prototype.toISOString||(Date.prototype.toISOString=function(){function a(a){return 10>a?"0"+a:a}return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"}),a.Subledger=b}(this);