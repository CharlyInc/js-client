/*! Subledger 1.0.0 | (c) 2013 Subledger | https://github.com/boocx2/Subledger_JS_Library/blob/master/LICENSE.txt */
!function(exports){var Subledger=function(a){this.url=a?helpers.removeTrailingSlash(a):""};Subledger.prototype.book=function(a){var b=this,c=b.url,d={};return c+="/books",d.get=function(b,d){helpers.isFunction(b)&&(d=b,b={}),a||(b.state=b.state?b.state:"active",b.starting=b.starting?b.starting:0,c=c+"?"+helpers.encodeQueryObj(b)),ajax.get(c,d)},d.create=function(a,b){ajax.post(c,a,b)},a&&(c=c+"/"+a,d.update=function(a,b){ajax.patch(c,a,b)},d.activate=function(a){ajax.post(c+"/activate",a)},d.archive=function(a){ajax.post(c+"/archive",a)},d.account=function(a){var b={};return c+="/accounts",b.get=function(b,d){helpers.isFunction(b)&&(d=b,b={}),a||(b.state=b.state?b.state:"active",b.starting=b.starting?b.starting:0,c=c+"?"+helpers.encodeQueryObj(b)),ajax.get(c,d)},b.create=function(a,b){ajax.post(c,a,b)},a&&(c=c+"/"+a,b.update=function(a,b){ajax.patch(c,a,b)},b.activate=function(a){ajax.post(c+"/activate",a)},b.archive=function(a){ajax.post(c+"/archive",a)},b.balance=function(a,b){helpers.isFunction(a)&&(b=a,a={}),a.at=a.at?a.at:(new Date).toISOString(),ajax.get(c+"/balance?"+helpers.encodeQueryObj(a),b)},b.line=function(a){var b={};return c+="/lines",b.get=function(b,d){helpers.isFunction(b)&&(d=b,b={}),a||(b.before=b.before?b.before:(new Date).toISOString(),c=c+"?"+helpers.encodeQueryObj(b)),ajax.get(c,d)},a&&(c=c+"/"+a),b}),b},d.journalEntry=function(a){var b={};return c+="/journal_entries",b.get=function(b,d){helpers.isFunction(b)&&(d=b,b={},b.before=(new Date).toISOString()),a||(b.state=b.state?b.state:"active",c=c+"?"+helpers.encodeQueryObj(b)),ajax.get(c,d)},b.create=function(a,b){ajax.post(c,a,b)},b.createAndPost=function(a,b){ajax.post(c+"/create_and_post",a,b)},a&&(c=c+"/"+a,b.post=function(a){ajax.post(c,a)},b.update=function(a,b){ajax.patch(c,a,b)},b.activate=function(a){ajax.post(c+"/activate",a)},b.archive=function(a){ajax.post(c+"/archive",a)},b.balance=function(a){ajax.get(c+"/balance",a)},b.progress=function(a){ajax.get(c+"/progress",a)},b.line=function(a){var b={};return b.get=function(b,d){helpers.isFunction(b)&&(d=b,b={}),a||(b.before=b.starting?b.starting:(new Date).toISOString(),b.state=b.state?b.state:"active",c=c+"/lines?"+helpers.encodeQueryObj(b)),ajax.get(c,d)},b.create=function(a,b){ajax.post(c+"/create_line",a,b)},a&&(c=c+"/lines/"+a,b.update=function(a,b){ajax.patch(c,a,b)},b.activate=function(a){ajax.post(c+"/activate",a)},b.archive=function(a){ajax.post(c+"/archive",a)}),b}),b}),d};var helpers={isArray:Array.isArray||function(a){return"[object Array]"===toString.call(a)},isObject:function(a){return"[object Object]"===toString.call(a)},isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},encodeQueryObj:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},removeTrailingSlash:function(a){return a.replace(/\/*$/,"")}},ajax=function(){function a(){this._callbacks=[]}function b(){var a;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}return a}function c(c,d,e,g){function h(){i.abort(),k.done(f.ETIMEOUT,"",i)}var i,j,k=new a;e=e||{},g=g||{};try{i=b()}catch(l){return k.done(f.ENOXHR,""),k}j=JSON.stringify(e),"GET"===c&&j&&(j=null),i.open(c,d),i.setRequestHeader("Accept","application/json"),i.setRequestHeader("Content-type","application/json"),i.setRequestHeader("X-Requested-With","XMLHttpRequest");for(var m in g)g.hasOwnProperty(m)&&i.setRequestHeader(m,g[m]);var n=f.ajaxTimeout;if(n)var o=setTimeout(h,n);return i.onreadystatechange=function(){if(n&&clearTimeout(o),4===i.readyState){var a=!i.status||(i.status<200||i.status>=300)&&304!==i.status;k.done(a,i.responseText,i)}},i.send(j),k}function d(a){return function(b,d,e){return c(a,b,d,e)}}function e(a,b){var c={};return c.data=JSON.parse(b),c.err=a?new Error(c.data.exception||""):null,c}a.prototype.then=function(b,c){var d;return this._isdone?d=b.apply(c,this.result):(d=new a,this._callbacks.push(function(){var a=b.apply(c,arguments);a&&"function"==typeof a.then&&a.then(d.done,d)})),d},a.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[]};var f={get:d("GET"),post:d("POST"),put:d("PUT"),patch:d("PATCH"),del:d("DELETE"),ENOXHR:1,ETIMEOUT:2,ajaxTimeout:0},g={get:function(a,b){f.get(a).then(function(a,c){return c=e(a,c),b(c.err,c.data)})},post:function(a,b,c){helpers.isFunction(b)&&(c=b,b={}),f.post(a,b).then(function(a,b){return b=e(a,b),c(b.err,b.data)})},put:function(a,b,c){helpers.isFunction(b)&&(c=b,b={}),f.put(a,b).then(function(a,b){return b=e(a,b),c(b.err,b.data)})},patch:function(a,b,c){helpers.isFunction(b)&&(c=b,b={}),f.patch(a,b).then(function(a,b){return b=e(a,b),c(b.err,b.data)})},del:function(a,b){f.del(a).then(function(a,c){return c=e(a,c),b(c.err,c.data)})}};return g}();Date.prototype.toISOString||(Date.prototype.toISOString=function(){function a(a){return 10>a?"0"+a:a}return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"}),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),exports.Subledger=Subledger}(this);